<Page
    x:Class="RemoteLogViewer.Views.SshSession.SshBrowserPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:controls="using:CommunityToolkit.WinUI.Controls"
	xmlns:fileViewer="using:RemoteLogViewer.Views.Ssh.FileViewer"
    xmlns:ssh="using:RemoteLogViewer.Services.Ssh"
    xmlns:sshVm="using:RemoteLogViewer.ViewModels.Ssh"
	xmlns:models="using:RemoteLogViewer.Models.Ssh"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	mc:Ignorable="d">

	<Page.Resources>
		<ResourceDictionary>
			<ResourceDictionary.MergedDictionaries>
				<ResourceDictionary Source="/Views/Styles/StarStyles.xaml" />
			</ResourceDictionary.MergedDictionaries>
		</ResourceDictionary>
	</Page.Resources>

	<controls:DockPanel Margin="4">
		<Grid RowDefinitions="auto,auto,auto,2*,auto,*" controls:DockPanel.Dock="Left" Width="360">
			<StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="4">
				<TextBox Width="240" Text="{x:Bind ViewModel.CurrentPath.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" KeyDown="CurrentPathTextBox_KeyDown" />
				<Button Content="Go" Command="{x:Bind ViewModel.NavigatePathCommand,Mode=OneWay}" />
			</StackPanel>
			<StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="4">
				<TextBox Width="240" Text="{x:Bind ViewModel.EntryFilterWord.Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" PlaceholderText="Filter" />
			</StackPanel>
			<TextBlock Grid.Row="2"  Text="Entries" FontWeight="SemiBold" Margin="0,4,0,2" />
			<ListView Grid.Row="3"  ItemsSource="{x:Bind ViewModel.Entries}"
					 ScrollViewer.VerticalScrollMode="Auto"
					 ScrollViewer.VerticalScrollBarVisibility="Auto"
					 IsItemClickEnabled="True" DoubleTapped="Entries_DoubleTapped">
				<ListView.ItemTemplate>
					<DataTemplate x:DataType="sshVm:FileSystemEntryViewModel">
						<Grid ColumnDefinitions="28,*" Padding="0,0,0,0">
							<ToggleButton Style="{StaticResource StarToggleButtonStyle}" Width="24" Height="24"
								IsChecked="{x:Bind IsBookmarked.Value, Mode=TwoWay}">
								<Grid>
									<FontIcon Glyph="&#xE735;" Foreground="Gold" Visibility="{x:Bind IsBookmarked.Value, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}" />
									<FontIcon Glyph="&#xE734;" Foreground="Gray" Visibility="{x:Bind IsBookmarked.Value, Mode=OneWay, Converter={StaticResource InverseBooleanToVisibilityConverter}}" />
								</Grid>
							</ToggleButton>
							<StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
								<FontIcon Glyph="&#xE8A5;" />
								<TextBlock Text="{x:Bind FileName}" />
							</StackPanel>
						</Grid>
					</DataTemplate>
				</ListView.ItemTemplate>
			</ListView>
			<TextBlock Grid.Row="4"  Text="Bookmarks" FontWeight="SemiBold" Margin="0,8,0,2" />
			<ListView ItemsSource="{x:Bind ViewModel.Bookmarks}"
					 Grid.Row="5"
					 ScrollViewer.VerticalScrollMode="Auto"
					 ScrollViewer.VerticalScrollBarVisibility="Auto"
					 DoubleTapped="Bookmarks_DoubleTapped">
				<ListView.ItemTemplate>
					<DataTemplate x:DataType="models:SshBookmarkModel">
						<StackPanel Orientation="Horizontal" Spacing="4" Padding="4,2">
							<FontIcon Glyph="&#xE735;" Foreground="Gold" />
							<TextBlock Text="{x:Bind Name.Value}" />
							<TextBlock Text="{x:Bind Path.Value}" Foreground="Gray" Margin="8,0,0,0" />
						</StackPanel>
					</DataTemplate>
				</ListView.ItemTemplate>
			</ListView>
		</Grid>
		<controls:DockPanel controls:DockPanel.Dock="Bottom" >
			<Button controls:DockPanel.Dock="Right" Content="Disconnect" Command="{x:Bind ViewModel.DisconnectCommand,Mode=OneWay}" />
			<Grid/>
		</controls:DockPanel>
		<fileViewer:TextFileViewer ViewModel="{x:Bind ViewModel.TextFileViewerViewModel}" />
	</controls:DockPanel>
</Page>